# Merger Tools [Experimental]

---
> 1 [Basics](#1)
>> 1.1 [New Project](#1.1)

>> 1.2 [Primary Mod](#1.2)

>> 1.3 [Generate Mod](#1.3)

> 2 [DBR Merger](#2)
>> 2.1 [Introduction](#2.1)

>> 2.2 [Loottables](#2.2)

>> 2.3 [Mastery](#2.3)

> 3 [Tag Merger (ToDo)](#3)

> 4 [Script Merger (ToDo)](#4)

> 5 [Order Of Things](#5)
>> 5.1 [Individual Mods](#5.1)

>> 5.2 [DBR](#5.2)

>> 5.3 [Speeding Up The Process](#5.3)

>> 5.4 [Data Storage](#5.4)

>> 5.5 [File Watcher (ToDo)](#5.5)

> 6 [Tips For Usage](#6)
>> 6.1 [gameengine.dbr](#6.1)

---
<a name="1"></a>
## 1 - Basics

<a name="1.1"></a>
### 1.1 - New Project
You can create a new project with the Button on the right ***New Project.*** This will create a new List Item, no files, yet. When you click on the new List Item you can see different options from which mods to use for merging up to differences in DBRs.

Your Projects are saved inside a Settings file for the Tool. Everything set up for the Project is saved in side this file as well. This means after the initial setup of your Compilation you don't have to bother with it again, the Program will check for updated files on its own.

<a name="1.2"></a>
### 1.2 - Primary Mod
This can be set in the Merger's Project Settings with a ComboBox, the Primary Mod has priority above all other mods. The Primary Mod file is loaded as a base, fields you mark will override those fields inside the Primary Mod's dbr.

The usage I had in mind for this is to make a mod with the files that are special to the Compilation, SkillTree fields in pc.dbrs are the best example, you wouldn't want to mess up those files with a mod update, enum files could be handled like that as well, just need the .dbr where the Mastery Enum is defined and the Tool will ignore those files unless you want to update a field. In the example of Enum files, there is more inside than the Mastery Enumeration, mark all fields except **masteryEnumeration** and the tool will update the DBR whenever necessary and leave the Mastery Enumeration field as you need it.

<a name="1.3"></a>
### 1.3 - Generate Mod
The Merged Mod can be generated by using the ***Generate*** Button, which will only appear if you have a Project selected. It may take a moment to copy files and generate the files from the DBR Merger.

---
<a name="2"></a>
## 2 - DBR Merger

<a name="2.1"></a>
### 2.1 - Introduction
You can see Duplicate Records and Unique Records, they are just that, Unique Records are being copied over if they are newer than the ones in the Project (this is not checking the files inside the Project folder but the timestamp inside the database). You can ignore a DBR by clicking on it first and checking the checkbox after. This may expand to Directories in later versions, if it is a feature used.

Dupe Records are the DBR in at least 2 Mods, when clicking on the entry you can see all the fields with multiple entries, check the fields you would like to keep. Empty fields are only considered if one DBR as an empty field where the other DBR has a value set, I believe it is better to know about it than just write a value in those fields and get confused about why something is not right.

<a name="2.2"></a>
### 2.2 - Loottables
Select the fields you **don't** want to have in your Loottable is enough, the program will generate a new Loottable based on the remaining fields. The reason for making this the opposite way is, because I believe most of the time you want to keep all entries and just remove dupes, which is done already and only excluding a drop remains.

If a field is using another field, like a Loottable usually has a lootName and a lootWeight. The lootWeight will be attached to the lootName and placed at the right position. Currently the only way to override a value is by having that entry with a new lootWeight inside the Primary Mod. Multiple entries for lootName won't be shown, keep in mind loot1Name and loot2Name are different arrays, duplicate DBR entries will be shown for it including their loot1Weight or loot2Weight depending where it belongs to. The number at the end lootNameX doesn't matter, this is being rearranged when the new DBR is generated.

<a name="2.3"></a>
### 2.3 - Mastery
The Mastery merger is still in progress. You will be able to merge the necessary files for Masteries to include in your Primary Mod, this will include tags for Mastery Combinations and SkillTree configurations (or Mastery Enumeration).

---
<a name="3"></a>
## 3 - Tag Merger
May not be there initially, but it is a merger that will merge all tag files together into one. This will prevent issues occuring for Mastery Names and other duplicate entries. The files from the Primary Mod are loaded last and override existing entries.

---
<a name="4"></a>
## 4 - Script Merger
This is a larger project including an attempt at Visual Scripting for Lua, so this will be in much later.

---
<a name="5"></a>
## 5 - Order Of Things

<a name="5.1"></a>
### 5.1 - Individual Mods
The Program starts by getting all folders inside the Directory set in the Settings. These are the mods' Folders displayed inside the Tools. By checking a Mod the Program will load the Mod's database files (this may take a moment, you can check the next Mod when it's finished).

**Note:** if you are changing Mod files after they have been loaded, you need to either restart the Program or use the Reload Button.

<a name="5.2"></a>
### 5.2 - DBR
Probably the largest piece of the Merge Tools. It starts by getting every file in the database folders, but it won't parse them right away, because it would take to long, instead it saves the full path inside the settings and checks for a timestamp, the timestamp is for mod updates, so files can be ignored if they have not been updated, no need to copy old files over.

Those DBRs with duplicates in other mods will show up in a separate list for you to check the differences. Since it would once again be pointless to display fields with the same values, you will see only those with different values and you can mark the ones you want to use in your Compilation.

**In Progress:** You can also compare DBRs to their Core counterparts, this could be interesting for gameengine.dbr to see if anything has changed since the last Grim Dawn update.

<a name="5.3"></a>
### 5.3 - Speeding Up The Process
If you had to check duplicate fields each time it wouldn't really make a difference to have a tool for it, no. Your settings are being saved and applied each time you're updating your Compilation.

<a name="5.4"></a>
### 5.4 - Data Storage
The button ***Reload Data*** is to reparse .dbr, this is not performed each time the list is generated, since it would take to much time in some cases. Once you click on DBR Setup and the list is loaded, all .dbr for duped Records are being parsed to accurately display their status, doing this each time you go into a file and change a setting and load the list again by using the Back button would cause the DBR to be parsed again, this was disabled to reduce loading times for larger projects.

You likely won't need to do this, unless you are updating a Mod while using the program, but in that case you should reload the entire project and not just the DBR, so the program collects all files again, in case the Mod in question added new files and not just updated the old ones, but in case of you changing manually this button is here.

<a name="5.5"></a>
### 5.5 - File Watcher
All of this manually reloading of things could be avoided if I hadn't had issues with certain paths using a File Watcher Module, but the one I was using didn't like braces and to avoid weird issues and confusion I'm just gonna go with manually reloading of stuff. The File Watcher Module received an update since than, so I'll look into it after the initial release.

---
<a name="6"></a>
## 6 - Tips for Usage

<a name="6.1"></a>
### 6.1 - gameengine.dbr
*this is not only useful for compilations but for everyone modifying the gameengine.dbr*
* Changes you want to have go either into the Primary Mod or are part of other Mods
  * Let's assume playerDevotionCap in Primary Mod is 59
* find gameenginge.dbr in one of the lists, if at least 2 mods have it it will be in **Dupe Records**, if only one has it you will have to go through **Unique Records** they are not visible right away, because a long list takes time to load, you can make the list visible by using the **Show Records** button on the right.
* when you have found it, click on it and you should see two checkboxes **Ignore** and **Use Vanilla** click on **Use Vanilla** this will bring you back to the lists, this time gameengine.dbr is going to be in **Dupe Records** and the tool should take you to it right away, no need to search it.
* click on it once again to see the differences, if nothing shows the files are identical, but you should see a list of fields. Vanilla values are after the field name (FieldName - Vanilla Value). Only fields with different values than Vanilla are listed, mark the ones you wish to override Vanilla with by clicking on them (they will appear green).
  * in this example playerDevotionCap (Vanilla should be at 55 in case of an xpac file, and your mod at 59)
* when the field is green use the **Back** button to return to the records lists. You can either continue with other dbrs or use the **Generate** button
  * new playerDevotionCap is 59
* next time there is an update to the gameengine file you don't need to do anything, simply use the **Generate** button.
  * new playerDevotionCap is 59 again, the program remembered the field you wanted to override


